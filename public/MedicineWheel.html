<!DOCTYPE html>
<html>
    <head>
      <title>Hello, WebXR! - A-Frame</title>
      <meta name="description" content="Hello, WebVR! - A-Frame">
      <script src="/js/aframe.min.js"></script>
      <!-- Packgage : Interaction -->
      <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>

      <!-- Packgage : Physic -->
      <!-- <script src="https://cdn.rawgit.com/aframevr/aframe/v0.5.0/dist/aframe-master.min.js"></script>  -->
      <!-- <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v$npm_package_version/dist/aframe-physics-system.min.js"></script> -->
      <script src="https://mixedreality.mozilla.org/ammo.js/builds/ammo.wasm.js"></script>
      <script src="http://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
      <script src="https://rawgit.com/takahirox/aframe-rain/master/build/aframe-rain.min.js"></script>
      


      
      <script>
            AFRAME.registerComponent('wheel-events', {
              // constructor
              schema: {section: {type : 'string', default : "",
                        active: {type : 'boolean', default : false}}
              },

              init: function(){
                  const CONTEXT_AF = this;

                  // event listener for the enity attached 
                  this.el.addEventListener('click',function(){
                  CONTEXT_AF.data.active = true;

                  //call the function based on section click - determine by the attribute
                  if(CONTEXT_AF.data.section == "north-rain"){
                    CONTEXT_AF.createRain(CONTEXT_AF);
                  }
                 })
              },
              
              createRain: function(CONTEXT_AF){
                let environment = document.querySelector('#scene');
                   let floor = document.querySelector("#ground");
                   let floor_size = floor.getAttribute('geometry');
                  
                  //create rain entity
                   let rain_temp = document.createElement('a-entity');

                   //set attribute
                   rain_temp.setAttribute('geometry', {primitive : 'cylinder', radius : 0.04, height : 0.5});
                   rain_temp.setAttribute('material', {color : '#526a82'})
                   rain_temp.setAttribute('ammo-body', {type : 'dynamic'});
                   rain_position = this.getRainLocation(floor_size.radius, floor_size.radius);
                   rain_temp.setAttribute('position',{x: rain_position[0], y:rain_position[1], z: rain_position[2]} );

                  //attached rain entity to the DOM
                   environment.appendChild(rain_temp);
              },
              // Funtion determine location of the rain
              getRainLocation : function(floor_width,floor_depth){
                const height = 3 ; //meter
                x_coordinate = (Math.random() * floor_width*5) - floor_width*2.5;
                y_coordinate = (Math.random() * 30) + 1;
                z_coordinate = (Math.random() * floor_depth*5) - floor_depth*2.5;

                //this.data.location =  [x_coordinate, y_coordinate,z_coordinate]
                return [x_coordinate,y_coordinate,z_coordinate]
              
              },

              tick : function(time){
               
                //active when the entity is being click
                if(this.data.active == true && this.data.section == 'north-rain'){
                    this.createRain();
                }
                
                
              }
                
            })
      </script>
    </head>
    <body>
      <a-scene  id = "scene"  physics="driver: ammo;"  >
      <a-assets>
        <a-img id = "rain-sky" src = "assets/medicine-wheel/Dark-Sky-rain.png"></a-img>
        <a-asset-item id = 'cloud' src = "assets/medicine-wheel/clouds/scene.gltf"></a-asset-item>
      </a-assets>
        <!-- Wall -->
      <a-entity geometry = "primitive: cylinder;
                            radius: 10;
                            height: 5;
                            open-ended: true" 
                material = "shader: flat;
                            color:#3b3030;
                            side: double
                            visible :false
                            "
                position = " 0 3 -0"
                scale = "-3 3 3"
                
                >
                <!-- ground -->
                <a-entity   id = "ground"
                            geometry = "primitive : circle; 
                                        radius : 10 "
                            material = "color: black"
                            position = "0 -1.5 0"
                            rotation = "-90 0 0"
                            >
                          <!-- medicine wheel -->
                          <a-entity geometry = "primitive: circle;
                                                radius : 2"
                                    material = "shader: standard;
                                                color : #5C5C5C"
                                    position = "0 0 0.1"
                                    rotation = "0 0 45"
                                                >
                                                <!-- each of the medicine portal-->
                                              <!-- first one | north  -->
                                              <a-entity geometry = "primitive : circle;
                                                                    radius: 1.9;
                                                                    thetaStart: 0;
                                                                    thetaLength: 90"
                                                        position = "0 0 0.01"
                                                        material = "color: #FFFFFF"
                                                        event-set__enter = "_event : mouseenter; material.color : #CFCFCF"
                                                        event-set__leave = "_event: mouseleave; material.color: #FFFFFF"
                                                        wheel-events = "section: north-rain"
                                                        ></a-entity>
                                              <!-- second one |  -->
                                              <a-entity geometry = "primitive : circle;
                                                                    radius: 1.9;
                                                                    thetaStart: 90;
                                                                    thetaLength: 90"
                                                        position = "0 0 0.01"
                                                        material = "color: #FFF71C"
                                                        event-set__enter = "_event : mouseenter; material.color : #C4BE18"
                                                        event-set__leave = "_event : mouseleave; material.color : #FFF71C"></a-entity>
                                              <a-entity geometry = "primitive : circle;
                                                                    radius: 1.9;
                                                                    thetaStart: 180;
                                                                    thetaLength: 90"
                                                        position = "0 0 0.01"
                                                        material = "color: #FF0000"
                                                        event-set__enter = "_event : mouseenter; material.color : #B00000"
                                                        event-set__leave = "_event : mouseleave; material.color : #FF0000"></a-entity>
                                              <a-entity geometry = "primitive : circle;
                                                                    radius: 1.9;
                                                                    thetaStart: 270;
                                                                    thetaLength: 90"
                                                        position = "0 0 0.01"
                                                        material = "color: #000000"
                                                        event-set__enter = "_event : mouseenter; material.color : #0D0D0D"
                                                        event-set__leave = "_event : mouseleave; material.color : #000000"></a-entity>></a-entity>
                                              </a-entity>

                                               <!-- cloud -->
                                               <a-entity gltf-model = '#cloud' scale = '0.5 0.5 0.5' position = '0 10 -10' rotation = '0 270 0'></a-entity>
                          </a-entity>
        </a-entity>
        <a-entity>
          <a-entity camera position = '0 1.6 0' look-controls wasd-controls>
            <a-cursor id = 'cursor' raycaster material = "color:#4FFFE5"></a-cursor>
          </a-entity>
          <a-sky src = "#rain-sky" segments-height = '10'>

          </a-sky>
        </a-entity>
     </a-scene>
    </body>
</html>